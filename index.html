<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>TEST</title>
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/weui.css">
</head>
<body>
    <div class="wrap index_page" id="index-box">         
        <!-- 首页 -->
        <div class="page2" v-show="pageStatus.one">
            <img src="images/logo.png" class="logo" alt="">
            <img src="images/title.png" class="title" alt="">
            <p>活动期间，签约我行电银渠道，同时激活存款账户，即可在微信端上随机领取京东电子卡、CBA明星签名篮球、现金红包等丰厚奖品。【数量有限，先到先得】</p>
            <div class="btn-box">
                <a href="javascript:;" @click="goHandle"><img src="images/go.png" alt=""></a>
                <a href="javascript:;" @click="pageStatus.two = true"><img src="images/rule.png" alt=""></a>
            </div>
        </div>

        <!-- 活动规则 -->
        <div class="page1" v-show="pageStatus.two"><!---->
            <span class="close" @click="pageStatus.two = false">x</span>
            <div class="pageBox">
                <img class="title" src="images/rule_title.png" alt="">
                <!-- <p>即日起-2018年02月28日活动期间，签约我行电银渠道，同时激活存款账户，即可在微信端上随机领取京东电子卡、CBA明星签名篮球、现金红包等丰厚奖品</p>
                <div><a href="javascript:;">活动奖项</a></div> -->
                <div><img src="images/gift.png" alt=""></div>
                <!-- <div><a href="javascript:;">抽奖结果</a></div>
                <p>电子券奖品以短信形式发送至客户中奖手机；实物奖品待活动结束后统一寄送,数量有限，先到先得!</p> -->
                <p class="tip">活动最终解释权在法律允许的范围内归稠州银行所有</p>
            </div>
        </div>

        <!-- 开奖页 -->
        <div class="page3" v-show="pageStatus.three">
            <img src="images/chai.png"  class="chai" :class="[lotteryState ? 'shake':'']" alt="" @click="lotteryHandle">
        </div>

        <!-- 京东电子卡和篮球奖品弹框 -->
        <div class="model giftModel" v-show="model.gift">
            <div class="modelBox">
                <div class="modelHeader"></div>
                <div class="modelBody">
                    <img :src="gift.imgSrc[gift.num]"  :class="[gift.num == 3 ? 'redpackImg':'giftImg']" alt=""> <!--images/gift2.png-->
                    <img class="openRed" v-if="gift.num == 3" src="images/kai.png" @click="openHandle" :class="[open ? 'kai_active':'']" alt=""> <!--kai_active-->
                    <img src="images/line.png" class="line" alt="">
                    <p class="txt">恭喜您</p>
                    <p>{{gift.txt}}</p> <!--获得京东电子券-->
                    <p v-show="gift.num != 3"><input type="text" name="" id="" v-model="gift.phone"></p>
                </div>
                <div class="modelFooter">
                    <span class="submit" v-show="gift.num != 3" @click="submitSure">
                        <img src="images/submit.png"  alt="">
                    </span>                    
                </div>
            </div>
        </div>        
        <!-- 确认电话号码弹框 -->
        <div class="model phoneModel" v-show="model.phone">
            <div class="modelBox">
                <div class="modelHeader"></div>
                <div class="modelBody">
                    <img src="images/phone.png" alt="">
                    <p>您输入的手机号码为</p>
                    <h3>{{gift.phone}}</h3>
                </div>
                <div class="modelFooter clf">
                    <span class="back" @click="model.gift = true;model.phone = false">
                        <img src="images/back.png"  alt="">
                    </span>
                    <span class="sure" @click="sureSubmitPhone">
                        <img src="images/sure.png"  alt="">
                    </span>                    
                </div>
            </div>
        </div>
        <!-- 奖品结果弹框 -->
        <div class="model resultModel" v-show="model.result" :class="[gift.num == 3 ? 'rewardModelRed' : '']"> 
            <div class="modelBox">
                <i class="close" @click="model.result = false;pageStatus.three=false;pageStatus.one = true;"><img src="images/close.png" alt=""></i>
                <div class="modelHeader"></div>
                <div class="modelBody" v-if="gift.num != 3">
                    <img :src="gift.resultSrc[gift.num]" class="giftImg" alt=""> <!--images/gift2.png-->
                    <p class="txt" v-html="gift.resultTxt[gift.num]"></p>
                    <p v-if="gift.num == 1">将发送至该{{gift.phone}}号码</p>
                    <p v-if="gift.num == 2">我们会与该{{gift.phone}}联系，<br/>请保持手机通畅</p>
                </div>
                <div class="modelMoney" v-else>
                    <img :src="gift.resultSrc[gift.num]" alt=""> <!--images/gift2.png-->
                    <p>{{gift.money}}<b>元</b></p>
                </div>
                <div class="modelFooter">
                    <p>注意信息查收，如有疑问<br>请拨打客服电话：0571-96527</p>                    
                </div>
            </div>
        </div>
        <!-- 抱歉弹框 -->
        <div class="model sorryModel" v-show="model.sorry">
            <div class="modelBox">
                <!-- <i class="close"><img src="images/close.png" alt=""></i> -->
                <div class="modelHeader"></div>
                <div class="modelBody">
                    <img class="img1" v-if="!sorry.num" src="images/sorry_1.png" alt="">
                    <img class="img1" v-if="sorry.num" src="images/sorry_2.png" alt="">
                    <div>
                        <p v-html="sorry.txt[sorry.num]"></p>
                    </div>
                </div>
                <div class="modelFooter clf">
                    <div v-if="sorry.num != 1 && sorry.num != 4 && sorry.num != 2">
                        <a href="javascript:;" class="submit" @click="model.sorry = false"><img src="images/sure_close.png" alt=""></a>
                    </div>
                    <div v-if="sorry.num == 2">
                        <a href="javascript:;" class="submit"><img src="images/go_sign.png" alt=""></a>
                    </div>    
                    <div v-if="sorry.num == 4">
                            <span class="back" @click="model.sorry = false;">
                                <img src="images/refuse.png"  alt="">
                            </span>
                            <span class="sure">
                                <img src="images/jihuo.png"  alt="">
                            </span> 
                    </div>           
                </div>
            </div>
        </div>

        <!-- 红包中间红包 -->
        <!-- <div class="model redPackModel" v-show="model.redpack">
            <div class="modelBox">
                <div class="modelHeader"></div>
                <div class="modelBody">
                    <img src="images/result_gift.png" class="giftImg" alt=""> 
                    <p>京东电子券<br>将发送至该手机号码</p>
                </div>
                <div class="modelFooter">
                    <p>注意信息查收，如有疑问<br>请拨打客服电话：0571-96527</p>                    
                </div>
            </div>
        </div> -->
        <!-- 加载中 -->
        <div id="loadingToast" v-show="loading.status">
            <div class="weui-mask_transparent"></div>
            <div class="weui-toast">
                <i class="weui-loading weui-icon_toast"></i>
                <p class="weui-toast__content" v-html="loading.txt"></p>
            </div>
        </div>
        <!--按钮提示框-->
        <!--BEGIN dialog2-->
        <div class="js_dialog" id="iosDialog2" v-show="dialog.status">
            <div class="weui-mask"></div>
            <div class="weui-dialog">
                <div class="weui-dialog__bd">{{dialog.txt}}</div>
                <div class="weui-dialog__ft">
                    <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary" @click="dialog.status = false">知道了</a>
                </div>
            </div>
        </div>
        <!-- 提示框，1000消失 -->
        <div class="tipBox" v-show="alert.status">
            <div class="tibBox_inner">
                <p v-html="alert.txt"></p>
            </div>
        </div>
    </div>
    <script src="js/zepto.min.js"></script>
    <script type="text/javascript">
        var basep = "images/", //图片目录
            preLoadSource = [ //背景资源
            basep + "back.png",
            basep + "chai.png",
            basep + "close.png",
            basep + "error.png",
            basep + "gift.png",
            basep + "gift1.png",
            basep + "gift2.png",
            basep + "gift3.png",
            basep + "go.png",
            basep + "go_sign.png",
            basep + "gx_title.png",
            basep + "index.jpg",
            basep + "index_bg.jpg",
            basep + "index_bg2.jpg",
            basep + "jihuo.png",
            basep + "kai.png",
            basep + "kefu.png",
            basep + "line.png",
            basep + "logo.png",
            basep + "phone.png",
            basep + "red_pack.png",
            basep + "refuse.png",
            basep + "result_gift.png",
            basep + "rule.png",
            basep + "rule_title.png",
            basep + "sorry_1.png",
            basep + "sorry_2.png",
            basep + "submit.png",
            basep + "sure.png",
            basep + "sure_close.png",
            basep + "title.png",
            basep + "win_3.png",
            ];
    </script>
    <script src="js/loading.js"></script>
    <script src="js/vue.min.js"></script>
    <script>
        //加载资源数组必须在loading之前进行配置
        $(function () {
            new Vue({
                el: "#index-box",
                data: {
                    pageStatus:{
                        one:true,       //首页
                        two:false,       //活动规则
                        three:false,    //开奖页
                    },
                    model:{
                        // redpack:false,   
                        result:false,   //奖品结果
                        phone:false,    //填写手机号码
                        gift:false,      //领奖
                        sorry:false,      //提示
                    },                    
                    lotteryState:false,    //抽奖状态
                    open:false,      //是否在开红包
                    gift:{
                        imgSrc:['','images/gift1.png','images/gift2.png','images/gift3.png'],
                        resultSrc:['','images/result_gift.png','images/gift2.png','images/win_3.png'],
                        resultTxt:['','京东电子券','篮球已成功领取'],
                        // txt:['获得京东电子券','获得CBA明星签名篮球','获得现金红包'],
                        txt:'',        //奖品名称
                        num:null,      //中奖等级；当is_prize为1时，此参数有值 ，1为京东券，2为篮球，3为微信红包
                        phone:'',
                        money:null,     //当prize_level为3时，此参数有值，为红包⾦额
                    },
                    is_sign:null,           //⽤户是否签约;1为已签约，0为未签约
                    is_activation:null,     //⽤户是否激活；1为已激活，0为未激活
                    is_prize:null,          //⽤户本周是否中过奖，1为已中奖，0为未中奖
                    is_draw:null,           //⽤户是否提交过资料，1为已提交过，0为未提交过
                    is_week:0,    //0为本周没抽奖，1是本周已抽过奖
                    sorry:{
                        txt:['','我行客服将尽快与您联系<br/>如有疑问，请拨打客服电话<br/><span>0571-96527</span>','您还未签约我行微信银行','本周您已领取过奖品,下周再来吧!','您还未达到账户激活标准哦','本周奖品已领完，期待下次吧。','很抱歉，您未中奖，下周再来吧。','您本周已抽奖，下周再来吧。'],
                        num:null,       
                        //1-我行客服将尽快与您联系如有疑问，请拨打客服电话 (确定) 
                        //2-您还未签约我行微信银行 (去签约)
                        //3-本周您已领取过奖品,下周再来吧! （确定）
                        //4-您还未达到账户激活标准哦  （拒绝  激活）
                        //5-本周奖品已领完，期待下次吧。 （确定）
                        //6-未中奖
                        //7-本周已抽过奖
                    },
                     
                    loading:{        //加载中弹框
                        status:false,
                        txt:'加载中...'
                    },
                    dialog:{    //带按钮提示框
                        status:false,
                        txt:'这里是提示内容'
                    },
                    alert:{     //提示自动消失框
                        status:false,
                        txt:'这里是提示内容'
                    },
                    linkHref:{
                        info:'http://wx.xhwxpos.com/bank_payments/index.php?m=Wap&c=Index&a=ajax_get_status&debug=1',              //用户信息接口
                        lottery:'http://wx.xhwxpos.com/bank_payments/index.php?m=Wap&c=Index&a=ajax_lottery&debug=1',              //抽奖接口
                        submitPhone:'http://wx.xhwxpos.com/bank_payments/index.php?m=Wap&c=Index&a=ajax_commit_mobile&debug=1',    //提交手机号
                        openRed:'http://wx.xhwxpos.com/bank_payments/index.php?m=Wap&c=Index&a=ajax_draw&debug=1',                 //打开红包
                    },
                },
                methods: {   
                    sureSubmitPhone:function(){  //确认提交信息
                        var This = this;
                        This.loading.status = true;
                        This.loading.txt = '提交中...';
                        //前端测试数据
                        // setTimeout(function(){
                        //     This.loading.status = false;
                        //         This.loading.txt = '';
                        //     This.model.phone = false;
                        //     This.model.result = true;
                        // },1000);
                        // return;
                        $.ajax({
                            url: This.linkHref.submitPhone,
                            dataType: 'json',
                            type: 'post',
                            data: {
                                'mobile':This.gift.phone
                            },
                            async: true,
                            success: function (res) {
                                This.loading.status = false;
                                This.loading.txt = '';
                                if(res.status == 0){
                                    This.model.phone = false;
                                    This.model.result = true;
                                }
                            },
                            error: function (XMLHttpRequest, textStatus, errorThrown) {
                                console.log(XMLHttpRequest)
                            }
                        })
                    },
                    submitSure:function(){   //手机号码提交按钮
                        var This = this;
                        if(this.gift.phone == ''){
                            this.alert.status = true;
                            this.alert.txt = '手机号码不能为空';
                            setTimeout(function(){
                                This.alert.status = false;
                            },1500)
                            return;
                        }
                        if(!this.isPhone(this.gift.phone)){
                            this.alert.status = true;
                            this.alert.txt = '手机号码格式不正确';
                            setTimeout(function(){
                                This.alert.status = false;
                            },1500)
                            return;
                        }
                        this.model.gift = false;
                        this.model.phone = true;

                    },
                    goHandle(){
                        if(!this.is_sign){ //未签约
                            this.model.sorry = true;
                            this.sorry.num = 2;
                            return;
                        }
                        if(!this.is_activation){   //未激活
                            this.model.sorry = true;
                            this.sorry.num = 4;
                            return;
                        }
                        this.pageStatus.three = true
                    },
                    openHandle:function(){  //开红包
                        var This = this;
                        this.open = true;
                        $.ajax({
                            url: This.linkHref.openRed,
                            dataType: 'json',
                            type: 'get',
                            data: {},
                            async: true,
                            success: function (res) {
                                setTimeout(function(){
                                    This.open = false;
                                    if(res.status == 0){                                    
                                        This.model.result = true;
                                        This.model.gift = false;
                                        This.gift.money = res.money;
                                    }
                                },1000)
                            },
                            error: function (XMLHttpRequest, textStatus, errorThrown) {
                                console.log(XMLHttpRequest)
                            }
                        })
                    },
                    lotteryHandle:function(){  //抽奖
                        var This = this;
                        this.lotteryState = true;
                        //前端测试数据
                        // var res = {
                        //     status:0,
                        //     is_prize:1,
                        //     prize_level:2,
                        //     prize_name:'京东券',
                        //     money:'99',
                        //     is_week:0,    //0为本周没抽奖，1是本周已抽过奖
                        // }
                        // setTimeout(function(){
                        //     This.lotteryState = false;
                        //     if(res.status == 0){
                        //         This.isPrize = res.is_prize;
                        //         This.is_week = res.is_week;
                        //         if(This.is_week){  //本周已抽奖
                        //             This.model.sorry = true;
                        //             This.sorry.num = 7;
                        //             return;
                        //         }
                        //         if(This.isPrize == 1){   //已中奖
                        //             This.model.gift = true;
                        //             This.gift.num = res.prize_level;
                        //             This.gift.txt = res.prize_name;
                        //             if(res.prize_level == 3){
                        //                 This.gift.money = res.money;
                        //             }
                        //         }else{  //未中奖
                        //             This.model.sorry = true;
                        //             This.sorry.num = 6;
                        //         }
                        //     }else if(res.status == 2){   //您本周已抽奖，下周再来吧。
                        //         This.model.sorry = true;
                        //         This.sorry.num = 5;
                        //     }else{

                        //     }                            
                        // },1000)
                        // return;
                        $.ajax({
                            url: This.linkHref.lottery,
                            dataType: 'json',
                            type: 'get',
                            data: {},
                            async: true,
                            success: function (res) {
                                This.lotteryState = false;
                                if(res.status == 0){
                                    This.isPrize = res.is_prize;
                                    This.is_week = res.is_week;
                                    if(This.is_week){  //本周已抽奖
                                        This.model.sorry = true;
                                        This.sorry.num = 7;
                                        return;
                                    }
                                    if(This.isPrize == 1){   //已中奖
                                        This.model.gift = true;
                                        This.gift.num = res.prize_level;
                                        This.gift.txt = res.prize_name;
                                        if(res.prize_level == 3){
                                            This.gift.money = res.money;
                                        }
                                    }else{  //未中奖
                                        This.model.sorry = true;
                                        This.sorry.num = 6;
                                    }
                                }else if(res.status == 2){   //您本周已抽奖，下周再来吧。
                                    This.model.sorry = true;
                                    This.sorry.num = 5;
                                }else{
    
                                }
                            },
                            error: function (XMLHttpRequest, textStatus, errorThrown) {
                                console.log(XMLHttpRequest)
                            }
                        })
                    },
                    getInfo: function () {
                        var This = this;
                        // 前端测试数据
                        // var res = {
                        //     is_sign:1,
                        //     is_activation:0,
                        //     is_prize:0,
                        //     is_draw:0,
                        //     prize_level:3,
                        //     prize_name:'京东电子券',
                        //     money:100
                        // }

                        // This.is_sign = res.is_sign;
                        // This.is_activation = res.is_activation;
                        // This.is_prize = res.is_prize;  
                        // This.is_draw = res.is_draw;
                        // This.gift.num = res.prize_level;   //中几等奖
                        // This.gift.txt = res.prize_name;    //中奖名称
                        // This.gift.money = res.money;
                        // if(!This.is_sign){ //未签约
                        //     This.model.sorry = true;
                        //     This.sorry.num = 2;
                        //     return;
                        // }
                        // if(!This.is_activation){   //未激活
                        //     This.model.sorry = true;
                        //     This.sorry.num = 4;
                        //     return;
                        // }
                        // if(This.is_prize){   //本周中奖
                        //     if(!This.is_draw){   //未领奖
                        //         This.model.gift = true;
                        //         return;
                        //     }
                        // }
                        // return false;
                        $.ajax({
                            url: This.linkHref.info,
                            dataType: 'json',
                            type: 'get',
                            data: {},
                            async: true,
                            success: function (res) {
                                if(res.status == 0){
                                    This.is_sign = res.is_sign;
                                    This.is_activation = res.is_activation;
                                    This.is_prize = res.is_prize;  
                                    This.is_draw = res.is_draw;
                                    This.gift.num = res.prize_level;   //中几等奖
                                    This.gift.txt = res.prize_name;    //中奖名称
                                    This.gift.money = res.money;
                                    // if(!This.is_sign){ //未签约
                                    //     This.model.sorry = true;
                                    //     This.sorry.num = 2;
                                    // }
                                    // if(!This.is_activation){   //未激活
                                    //     This.model.sorry = true;
                                    //     This.sorry.num = 4;
                                    // }
                                    if(This.is_prize){   //本周中奖
                                        if(!This.is_draw){   //未领奖
                                            This.model.gift = true;
                                        }
                                    }
                                }
                            },
                            error: function (XMLHttpRequest, textStatus, errorThrown) {
                                console.log(XMLHttpRequest)
                            }
                        })
                    },
                    isPhone : function(str) {  //判断是否是正确的手机
                        if(typeof str === 'number'){
                            str = str.toString();
                        }
                        return /^0?1[3|4|5|7|8][0-9]\d{8}$/.test(str);
                    },
                    init: function () {
                        this.getInfo();  //获取个人信息
                    }
                },
                mounted: function () {
                    this.init();
                }
            })
        })
    </script>

</body>

</html>